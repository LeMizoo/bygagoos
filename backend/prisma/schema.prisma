// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            Int       @id @default(autoincrement())
  username      String    @unique
  password      String
  firstName     String
  lastName      String
  email         String    @unique
  role          String    @default("USER")
  profileImage  String?
  familyId      Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  activityLogs  ActivityLog[]
  assignedTasks Task[]
  
  @@index([familyId])
}

model Client {
  id            Int       @id @default(autoincrement())
  name          String
  email         String    @unique
  phone         String?
  address       String?
  company       String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  orders        Order[]
  
  @@index([name])
  @@index([email])
}

model Product {
  id            Int       @id @default(autoincrement())
  name          String
  description   String?
  price         Float
  category      String
  stock         Int       @default(0)
  minStock      Int       @default(10)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  orderItems    OrderItem[]
  
  @@index([name])
  @@index([category])
}

model Order {
  id            Int         @id @default(autoincrement())
  orderNumber   String      @unique
  clientId      Int
  client        Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  totalAmount   Float
  status        String      @default("PENDING")
  notes         String?
  deliveryDate  DateTime?
  deadline      DateTime?
  priority      String      @default("MEDIUM")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  orderItems    OrderItem[]
  tasks         Task[]
  
  @@index([clientId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
  @@index([priority])
}

model OrderItem {
  id            Int       @id @default(autoincrement())
  orderId       Int
  order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId     Int
  product       Product   @relation(fields: [productId], references: [id])
  quantity      Int
  price         Float
  notes         String?
  createdAt     DateTime  @default(now())
  
  @@index([orderId])
  @@index([productId])
}

model Task {
  id            Int       @id @default(autoincrement())
  orderId       Int
  order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  type          String    @default("PRINTING")
  name          String
  description   String?
  assignedToId  Int?
  assignedTo    User?     @relation(fields: [assignedToId], references: [id], onDelete: SetNull)
  status        String    @default("PENDING")
  startTime     DateTime?
  endTime       DateTime?
  estimatedHours Float?
  actualHours   Float?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([orderId])
  @@index([assignedToId])
  @@index([status])
}

model Consumable {
  id            Int       @id @default(autoincrement())
  name          String
  description   String?
  category      String
  stock         Int       @default(0)
  minStock      Int       @default(5)
  unit          String    @default("pi√®ce")
  supplier      String?
  lastOrderDate DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([name])
  @@index([category])
}

model ActivityLog {
  id            Int       @id @default(autoincrement())
  userId        Int?
  user          User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  action        String
  details       String?
  ipAddress     String?
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}